<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İşyeri Hekimliği Uygulaması</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #27ae60;
            --warning: #f39c12;
            --background: #f5f7fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--light);
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .logo span {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--success);
            color: white;
        }
        
        .btn-info {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            transition: transform 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-5px);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }
        
        .section-title {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .list-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .list-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-item:hover {
            background-color: #f8f9fa;
        }
        
        .list-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary);
        }
        
        .list-item .actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--dark);
            cursor: pointer;
            font-size: 1.1rem;
            transition: color 0.2s;
        }
        
        .action-btn:hover {
            color: var(--accent);
        }
        
        .form-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .form-content {
            background-color: white;
            border-radius: 15px;
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--accent);
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background-color: #f8f9fa;
            transform: rotate(90deg);
        }
        
        .form-title {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input[type="text"],
        input[type="date"],
        input[type="tel"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .signature-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .signature-line {
            width: 300px;
            height: 1px;
            background-color: #333;
            margin: 20px 0 10px;
        }
        
        .signature-label {
            font-weight: 600;
            color: var(--primary);
        }
        
        .form-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-card i {
            color: var(--secondary);
            min-width: 20px;
        }
        
        .medical-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ddd;
        }
        
        .medical-section h4 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .medical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .medical-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .medical-question {
            flex-grow: 1;
        }
        
        .medical-answer {
            display: flex;
            gap: 15px;
        }
        
        .employee-details {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .employee-detail-card {
            flex: 1;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: 12px;
            padding: 20px;
        }
        
        .excel-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .actions {
                width: 100%;
                justify-content: center;
            }
            
            .form-content {
                padding: 20px 15px;
                margin: 20px auto;
            }
            
            .section {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .employee-details {
                flex-direction: column;
            }
            
            .excel-actions {
                flex-direction: column;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background-color: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background-color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">İşlem başarıyla tamamlandı!</div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-user-md"></i>
                <div>
                    <h1>İşyeri Hekimliği Uygulaması</h1>
                    <span>Çalışan Sağlığı Takip Sistemi</span>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="newWorkplaceBtn">
                    <i class="fas fa-building"></i> Yeni İşyeri
                </button>
                <button class="btn btn-secondary" id="newEmployeeBtn">
                    <i class="fas fa-user-plus"></i> Yeni Çalışan
                </button>
                <button class="btn btn-info" id="settingsBtn">
                    <i class="fas fa-cog"></i> Ayarlar
                </button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">İşyerleri</h2>
                        <button class="btn btn-primary" id="addWorkplaceBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="list-container" id="workplaceList">
                        <!-- İşyerleri burada dinamik olarak yüklenecek -->
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Çalışanlar</h2>
                        <button class="btn btn-secondary" id="addEmployeeBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="list-container" id="employeeList">
                        <!-- Çalışanlar burada dinamik olarak yüklenecek -->
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Çalışan Detayları</h2>
                    <button class="btn btn-info" id="ek2FormBtn">
                        <i class="fas fa-file-medical"></i> Ek-2 Formu Oluştur
                    </button>
                </div>
                
                <div class="excel-actions">
                    <button class="btn btn-warning" id="importExcelBtn">
                        <i class="fas fa-file-import"></i> Excel'den Al
                    </button>
                    <button class="btn btn-success" id="exportExcelBtn">
                        <i class="fas fa-file-export"></i> Excel'e Aktar
                    </button>
                </div>
                
                <div class="employee-details">
                    <div class="employee-detail-card">
                        <h3><i class="fas fa-user"></i> Kişisel Bilgiler</h3>
                        <p><i class="fas fa-id-card"></i> <strong>Ad Soyad:</strong> <span id="employeeName">-</span></p>
                        <p><i class="fas fa-id-badge"></i> <strong>TC Kimlik No:</strong> <span id="employeeTckn">-</span></p>
                        <p><i class="fas fa-birthday-cake"></i> <strong>Doğum Tarihi:</strong> <span id="employeeBirthDate">-</span></p>
                        <p><i class="fas fa-venus-mars"></i> <strong>Cinsiyet:</strong> <span id="employeeGender">-</span></p>
                        <p><i class="fas fa-graduation-cap"></i> <strong>Eğitim Durumu:</strong> <span id="employeeEducation">-</span></p>
                        <p><i class="fas fa-home"></i> <strong>Adres:</strong> <span id="employeeAddress">-</span></p>
                    </div>
                    
                    <div class="employee-detail-card">
                        <h3><i class="fas fa-briefcase"></i> İş Bilgileri</h3>
                        <p><i class="fas fa-building"></i> <strong>İşyeri:</strong> <span id="employeeWorkplace">-</span></p>
                        <p><i class="fas fa-tag"></i> <strong>Departman:</strong> <span id="employeeDepartment">-</span></p>
                        <p><i class="fas fa-user-tie"></i> <strong>Pozisyon:</strong> <span id="employeePosition">-</span></p>
                        <p><i class="fas fa-calendar-alt"></i> <strong>İşe Giriş Tarihi:</strong> <span id="employeeStartDate">-</span></p>
                        <p><i class="fas fa-stethoscope"></i> <strong>Son Muayene Tarihi:</strong> <span id="employeeLastExam">-</span></p>
                        <p><i class="fas fa-file-medical"></i> <strong>Sonraki Muayene Tarihi:</strong> <span id="employeeNextExam">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ayarlar Modalı -->
    <div class="form-container" id="settingsModal">
        <div class="form-content">
            <button class="close-btn" id="closeSettings">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="form-title">Doktor Ayarları</h2>
            
            <form id="settingsForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="doctorName">Adı Soyadı</label>
                        <input type="text" id="doctorName" placeholder="Doktor adı soyadı">
                    </div>
                    
                    <div class="form-group">
                        <label for="doctorTitle">Ünvan</label>
                        <input type="text" id="doctorTitle" placeholder="Ünvan">
                    </div>
                    
                    <div class="form-group">
                        <label for="diplomaDate">Diploma Tarihi</label>
                        <input type="date" id="diplomaDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="diplomaNo">Diploma No</label>
                        <input type="text" id="diplomaNo" placeholder="Diploma numarası">
                    </div>
                    
                    <div class="form-group">
                        <label for="certificateDate">Sertifika Tarihi</label>
                        <input type="date" id="certificateDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="certificateNo">Sertifika No</label>
                        <input type="text" id="certificateNo" placeholder="Sertifika numarası">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="saveSettings">
                        <i class="fas fa-save"></i> Ayarları Kaydet
                    </button>
                    <button type="button" class="btn" id="cancelSettings" style="background-color: #95a5a6; color: white;">
                        <i class="fas fa-times"></i> İptal
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ek-2 Muayene Formu -->
    <div class="form-container" id="ek2Form">
        <div class="form-content">
            <button class="close-btn" id="closeEk2Form">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="form-title">İŞYERİ HEKİMLİĞİ EK-2 MUAYENE FORMU</h2>
            
            <div class="info-card">
                <h3><i class="fas fa-user"></i> Çalışan Bilgileri</h3>
                <p><i class="fas fa-user"></i> <strong>Ad Soyad:</strong> <span id="ek2EmployeeName">-</span></p>
                <p><i class="fas fa-id-card"></i> <strong>TC Kimlik No:</strong> <span id="ek2EmployeeTckn">-</span></p>
                <p><i class="fas fa-building"></i> <strong>İşyeri:</strong> <span id="ek2WorkplaceName">-</span></p>
                <p><i class="fas fa-calendar-alt"></i> <strong>Muayene Tarihi:</strong> <span id="ek2ExamDate">-</span></p>
            </div>
            
            <div class="medical-section">
                <h4><i class="fas fa-history"></i> Tıbbi Özgeçmiş</h4>
                <div class="medical-grid">
                    <div class="medical-item">
                        <div class="medical-question">Kan Grubu</div>
                        <input type="text" id="ek2BloodType" placeholder="Kan grubu">
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Kronik Hastalık</div>
                        <input type="text" id="ek2ChronicDisease" placeholder="Varsa belirtiniz">
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Tetanoz Aşısı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" id="tetanoz_yes" name="tetanoz" value="yes">
                                <label for="tetanoz_yes">Var</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tetanoz_no" name="tetanoz" value="no">
                                <label for="tetanoz_no">Yok</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Hepatit Aşısı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" id="hepatit_yes" name="hepatit" value="yes">
                                <label for="hepatit_yes">Var</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="hepatit_no" name="hepatit" value="no">
                                <label for="hepatit_no">Yok</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="medical-section">
                <h4><i class="fas fa-stethoscope"></i> Tıbbi Anamnez</h4>
                <div class="medical-grid">
                    <div class="medical-item">
                        <div class="medical-question">Balgamlı öksürük</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="cough" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="cough" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Nefes darlığı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="breath" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="breath" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Göğüs ağrısı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="chest_pain" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="chest_pain" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Çarpıntı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="palpitation" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="palpitation" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Kalp hastalığı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="heart_disease" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="heart_disease" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-item">
                        <div class="medical-question">Şeker hastalığı</div>
                        <div class="medical-answer">
                            <div class="radio-option">
                                <input type="radio" name="diabetes" value="no">
                                <label>Hayır</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="diabetes" value="yes">
                                <label>Evet</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="medical-section">
                <h4><i class="fas fa-heartbeat"></i> Fizik Muayene Sonuçları</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="blood_pressure">Tansiyon (TA)</label>
                        <input type="text" id="blood_pressure" placeholder="Ör: 120/80 mm-Hg">
                    </div>
                    
                    <div class="form-group">
                        <label for="pulse">Nabız (Nb)</label>
                        <input type="text" id="pulse" placeholder="Ör: 72/dk">
                    </div>
                    
                    <div class="form-group">
                        <label for="height">Boy (cm)</label>
                        <input type="number" id="height" placeholder="Boy uzunluğu">
                    </div>
                    
                    <div class="form-group">
                        <label for="weight">Kilo (kg)</label>
                        <input type="number" id="weight" placeholder="Vücut ağırlığı">
                    </div>
                    
                    <div class="form-group">
                        <label for="bmi">Vücut Kitle İndeksi</label>
                        <input type="text" id="bmi" placeholder="Otomatik hesaplanacak" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="physical_exam">Muayene Notları</label>
                    <textarea id="physical_exam" rows="4" placeholder="Fizik muayene bulgularınız..."></textarea>
                </div>
            </div>
            
            <div class="medical-section">
                <h4><i class="fas fa-vial"></i> Laboratuvar Bulguları</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="blood_test">Kan Tahlili</label>
                        <textarea id="blood_test" rows="2" placeholder="Kan tahlil sonuçları..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="urine_test">İdrar Tahlili</label>
                        <textarea id="urine_test" rows="2" placeholder="İdrar tahlil sonuçları..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="radiology">Radyolojik Bulgular</label>
                        <textarea id="radiology" rows="2" placeholder="Radyolojik inceleme sonuçları..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="other_tests">Diğer Testler</label>
                        <textarea id="other_tests" rows="2" placeholder="Diğer test sonuçları..."></textarea>
                    </div>
                </div>
            </div>
            
            <div class="medical-section">
                <h4><i class="fas fa-file-medical-alt"></i> Kanaat ve Sonuç</h4>
                <div class="form-group">
                    <div class="radio-option" style="margin-bottom: 15px;">
                        <input type="radio" id="fit1" name="fitness" value="fit" checked>
                        <label for="fit1"><strong>1- İşinde bedenen ve ruhen çalışmaya elverişlidir.</strong></label>
                    </div>
                    
                    <div class="radio-option" style="margin-bottom: 15px;">
                        <input type="radio" id="fit2" name="fitness" value="conditional">
                        <label for="fit2"><strong>2- Aşağıdaki şart ile çalışmaya elverişlidir</strong></label>
                    </div>
                    
                    <div class="form-group">
                        <textarea id="conditions" rows="3" placeholder="Çalışma şartlarını belirtiniz..." style="margin-top: 10px;"></textarea>
                    </div>
                </div>
                
                <p><em>(*Yapılan muayene sonucunda çalışanın gece veya vardiyalı çalışma koşullarında çalışıp çalışamayacağı ile vücut sağlığını ve bütünlüğünü tamamlayıcı uygun alet teçhizat vs... bulunması durumunda çalışan için bu koşullarla çalışmaya elverişli olup olmadığı kanaati belirtilecektir.)</em></p>
            </div>
            
            <div class="signature-area">
                <p>... / ... / 20...</p>
                <div class="signature-line"></div>
                <div class="signature-label">İşyeri Hekimi İmza</div>
                <div style="margin-top: 15px;">
                    <p>Adı ve Soyadı: <strong id="ek2DoctorName">Dr. Ayşe Kaya</strong></p>
                    <p>Diploma Tarih ve No: <span id="ek2DiplomaInfo">15/06/2010 - 12345</span></p>
                    <p>İşyeri Hekimliği Belgesi Tarih ve No: <span id="ek2CertificateInfo">20/07/2015 - 67890</span></p>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" id="saveMedicalForm">
                    <i class="fas fa-save"></i> Kaydet
                </button>
                <button type="button" class="btn btn-secondary" id="printMedicalForm">
                    <i class="fas fa-print"></i> Yazdır
                </button>
                <button type="button" class="btn" id="clearMedicalForm" style="background-color: var(--warning); color: white;">
                    <i class="fas fa-eraser"></i> Temizle
                </button>
            </div>
        </div>
    </div>

    <!-- İşyeri Ekleme/Düzenleme Modalı -->
    <div class="form-container" id="workplaceModal">
        <div class="form-content">
            <button class="close-btn" id="closeWorkplaceModal">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="form-title" id="workplaceModalTitle">Yeni İşyeri Ekle</h2>
            
            <form id="workplaceForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="workplaceName">İşyeri Adı</label>
                        <input type="text" id="workplaceName" placeholder="İşyeri adı" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="workplaceSskNo">SGK Sicil No</label>
                        <input type="text" id="workplaceSskNo" placeholder="SGK sicil numarası">
                    </div>
                    
                    <div class="form-group">
                        <label for="workplaceAddress">Adres</label>
                        <textarea id="workplaceAddress" rows="2" placeholder="İşyeri adresi"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="workplacePhone">Telefon</label>
                        <input type="tel" id="workplacePhone" placeholder="Telefon numarası">
                    </div>
                    
                    <div class="form-group">
                        <label for="workplaceEmail">E-posta</label>
                        <input type="email" id="workplaceEmail" placeholder="E-posta adresi">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="saveWorkplaceBtn">
                        <i class="fas fa-save"></i> Kaydet
                    </button>
                    <button type="button" class="btn" id="cancelWorkplaceBtn" style="background-color: #95a5a6; color: white;">
                        <i class="fas fa-times"></i> İptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Çalışan Ekleme/Düzenleme Modalı -->
    <div class="form-container" id="employeeModal">
        <div class="form-content">
            <button class="close-btn" id="closeEmployeeModal">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="form-title" id="employeeModalTitle">Yeni Çalışan Ekle</h2>
            
            <form id="employeeForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="employeeName">Ad Soyad</label>
                        <input type="text" id="employeeName" placeholder="Ad soyad" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeTckn">TC Kimlik No</label>
                        <input type="text" id="employeeTckn" placeholder="TC kimlik numarası" required maxlength="11">
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeBirthDate">Doğum Tarihi</label>
                        <input type="date" id="employeeBirthDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeGender">Cinsiyet</label>
                        <select id="employeeGender">
                            <option value="">Seçiniz</option>
                            <option value="Erkek">Erkek</option>
                            <option value="Kadın">Kadın</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeEducation">Eğitim Durumu</label>
                        <select id="employeeEducation">
                            <option value="">Seçiniz</option>
                            <option value="İlkokul">İlkokul</option>
                            <option value="Ortaokul">Ortaokul</option>
                            <option value="Lise">Lise</option>
                            <option value="Üniversite">Üniversite</option>
                            <option value="Yüksek Lisans">Yüksek Lisans</option>
                            <option value="Doktora">Doktora</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeAddress">Adres</label>
                        <textarea id="employeeAddress" rows="2" placeholder="Adres"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="employeePhone">Telefon</label>
                        <input type="tel" id="employeePhone" placeholder="Telefon numarası">
                    </div>
                    
                    <div class="form-group">
                        <label for="employeePosition">Pozisyon</label>
                        <input type="text" id="employeePosition" placeholder="Pozisyon">
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeDepartment">Departman</label>
                        <input type="text" id="employeeDepartment" placeholder="Departman">
                    </div>
                    
                    <div class="form-group">
                        <label for="employeeStartDate">İşe Giriş Tarihi</label>
                        <input type="date" id="employeeStartDate">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="saveEmployeeBtn">
                        <i class="fas fa-save"></i> Kaydet
                    </button>
                    <button type="button" class="btn" id="cancelEmployeeBtn" style="background-color: #95a5a6; color: white;">
                        <i class="fas fa-times"></i> İptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Veritabanı Sınıfı
        class Database {
            constructor() {
                this.dbName = 'isyeriHekimligiDB';
                this.version = 5;
                this.db = null;
            }

            async initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);

                    request.onerror = (event) => {
                        console.error("Veritabanı hatası:", event.target.error);
                        reject(event.target.error);
                    };

                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        resolve(this.db);
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        if (!db.objectStoreNames.contains('workplaces')) {
                            db.createObjectStore('workplaces', { keyPath: 'id' });
                        }
                        
                        let employeeStore;
                        if (!db.objectStoreNames.contains('employees')) {
                            employeeStore = db.createObjectStore('employees', { keyPath: 'id' });
                        } else {
                            employeeStore = event.target.transaction.objectStore('employees');
                        }
                        
                        if (!employeeStore.indexNames.contains('workplaceId')) {
                            employeeStore.createIndex('workplaceId', 'workplaceId', { unique: false });
                        }

                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings', { keyPath: 'id' });
                        }
                    };
                });
            }

            async getWorkplaces() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['workplaces'], 'readonly');
                    const store = transaction.objectStore('workplaces');
                    const request = store.getAll();

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async addWorkplace(workplace) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['workplaces'], 'readwrite');
                    const store = transaction.objectStore('workplaces');
                    const request = store.add(workplace);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async updateWorkplace(workplace) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['workplaces'], 'readwrite');
                    const store = transaction.objectStore('workplaces');
                    const request = store.put(workplace);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async deleteWorkplace(id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['workplaces'], 'readwrite');
                    const store = transaction.objectStore('workplaces');
                    const request = store.delete(id);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async getEmployees(workplaceId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['employees'], 'readonly');
                    const store = transaction.objectStore('employees');
                    const index = store.index('workplaceId');
                    const request = index.getAll(workplaceId);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async addEmployee(employee) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['employees'], 'readwrite');
                    const store = transaction.objectStore('employees');
                    const request = store.add(employee);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async updateEmployee(employee) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['employees'], 'readwrite');
                    const store = transaction.objectStore('employees');
                    const request = store.put(employee);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async deleteEmployee(id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['employees'], 'readwrite');
                    const store = transaction.objectStore('employees');
                    const request = store.delete(id);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async getSettings() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['settings'], 'readonly');
                    const store = transaction.objectStore('settings');
                    const request = store.get('doctorSettings');

                    request.onsuccess = () => resolve(request.result || {});
                    request.onerror = (event) => reject(event.target.error);
                });
            }

            async saveSettings(settings) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['settings'], 'readwrite');
                    const store = transaction.objectStore('settings');
                    const request = store.put({
                        id: 'doctorSettings',
                        ...settings
                    });

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = (event) => reject(event.target.error);
                });
            }
        }

        // Uygulama State'i
        const appState = {
            db: new Database(),
            currentUser: null,
            currentWorkplace: null,
            currentEmployee: null,
            currentEmployees: [],
            workplaces: []
        };

        // DOM Elementleri
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const saveSettingsBtn = document.getElementById('saveSettings');
        const cancelSettingsBtn = document.getElementById('cancelSettings');
        const ek2FormBtn = document.getElementById('ek2FormBtn');
        const ek2Form = document.getElementById('ek2Form');
        const closeEk2Form = document.getElementById('closeEk2Form');
        const saveMedicalFormBtn = document.getElementById('saveMedicalForm');
        const printMedicalFormBtn = document.getElementById('printMedicalForm');
        const clearMedicalFormBtn = document.getElementById('clearMedicalForm');
        const newWorkplaceBtn = document.getElementById('newWorkplaceBtn');
        const newEmployeeBtn = document.getElementById('newEmployeeBtn');
        const workplaceModal = document.getElementById('workplaceModal');
        const closeWorkplaceModal = document.getElementById('closeWorkplaceModal');
        const saveWorkplaceBtn = document.getElementById('saveWorkplaceBtn');
        const cancelWorkplaceBtn = document.getElementById('cancelWorkplaceBtn');
        const employeeModal = document.getElementById('employeeModal');
        const closeEmployeeModal = document.getElementById('closeEmployeeModal');
        const saveEmployeeBtn = document.getElementById('saveEmployeeBtn');
        const cancelEmployeeBtn = document.getElementById('cancelEmployeeBtn');
        const importExcelBtn = document.getElementById('importExcelBtn');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const workplaceList = document.getElementById('workplaceList');
        const employeeList = document.getElementById('employeeList');
        const heightInput = document.getElementById('height');
        const weightInput = document.getElementById('weight');
        const bmiInput = document.getElementById('bmi');
        
        // Bildirim Gösterme
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification' + (isError ? ' error' : '') + ' show';
            
            setTimeout(() => {
                notification.className = 'notification';
            }, 3000);
        }
        
        // Sayfa Yüklendiğinde
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await appState.db.initDB();
                await loadWorkplaces();
                await loadSettings();
                
                // Event listener'ları ekle
                initEventListeners();
                
            } catch (error) {
                console.error('Başlatma hatası:', error);
                showNotification('Uygulama başlatılırken bir hata oluştu: ' + error.message, true);
            }
        });
        
        // Event listener'ları başlat
        function initEventListeners() {
            // Ayarlar modalını aç
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
            
            // Ayarları kaydet
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            // Ayarları iptal et
            cancelSettingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Ek-2 formunu aç
            ek2FormBtn.addEventListener('click', openEk2Form);
            
            // Formu kapat
            closeEk2Form.addEventListener('click', () => {
                ek2Form.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // BMI hesaplama
            heightInput.addEventListener('input', calculateBMI);
            weightInput.addEventListener('input', calculateBMI);
            
            // Formu kaydet
            saveMedicalFormBtn.addEventListener('click', saveMedicalForm);
            
            // Formu yazdır
            printMedicalFormBtn.addEventListener('click', () => {
                window.print();
            });
            
            // Formu temizle
            clearMedicalFormBtn.addEventListener('click', () => {
                if (confirm('Formdaki tüm verileri temizlemek istediğinize emin misiniz?')) {
                    const formElements = ek2Form.querySelectorAll('input, textarea, select');
                    formElements.forEach(element => {
                        if (element.type === 'radio' || element.type === 'checkbox') {
                            element.checked = false;
                        } else {
                            element.value = '';
                        }
                    });
                }
            });
            
            // Yeni işyeri ekle
            newWorkplaceBtn.addEventListener('click', () => openWorkplaceModal());
            
            // Yeni çalışan ekle
            newEmployeeBtn.addEventListener('click', () => openEmployeeModal());
            
            // İşyeri formu kapat
            closeWorkplaceModal.addEventListener('click', () => {
                workplaceModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Çalışan formu kapat
            closeEmployeeModal.addEventListener('click', () => {
                employeeModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // İşyeri kaydet
            saveWorkplaceBtn.addEventListener('click', saveWorkplace);
            
            // Çalışan kaydet
            saveEmployeeBtn.addEventListener('click', saveEmployee);
            
            // Excel'den al
            importExcelBtn.addEventListener('click', importEmployeesFromExcel);
            
            // Excel'e aktar
            exportExcelBtn.addEventListener('click', exportEmployeesToExcel);
            
            // Dışarı tıklayınca modalları kapat
            window.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                if (e.target === ek2Form) {
                    ek2Form.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                if (e.target === workplaceModal) {
                    workplaceModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                if (e.target === employeeModal) {
                    employeeModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        // Ayarları yükle
        async function loadSettings() {
            try {
                const settings = await appState.db.getSettings();
                document.getElementById('doctorName').value = settings.name || '';
                document.getElementById('doctorTitle').value = settings.title || '';
                document.getElementById('diplomaDate').value = settings.diplomaDate || '';
                document.getElementById('diplomaNo').value = settings.diplomaNo || '';
                document.getElementById('certificateDate').value = settings.certificateDate || '';
                document.getElementById('certificateNo').value = settings.certificateNo || '';
                
                // Ek-2 formu için doktor bilgilerini güncelle
                document.getElementById('ek2DoctorName').textContent = settings.name || 'Dr. Ayşe Kaya';
                document.getElementById('ek2DiplomaInfo').textContent = (settings.diplomaDate ? formatDate(settings.diplomaDate) : '15/06/2010') + ' - ' + (settings.diplomaNo || '12345');
                document.getElementById('ek2CertificateInfo').textContent = (settings.certificateDate ? formatDate(settings.certificateDate) : '20/07/2015') + ' - ' + (settings.certificateNo || '67890');
                
            } catch (error) {
                console.error('Ayarlar yüklenirken hata:', error);
            }
        }
        
        // Ayarları kaydet
        async function saveSettings() {
            try {
                const settings = {
                    name: document.getElementById('doctorName').value,
                    title: document.getElementById('doctorTitle').value,
                    diplomaDate: document.getElementById('diplomaDate').value,
                    diplomaNo: document.getElementById('diplomaNo').value,
                    certificateDate: document.getElementById('certificateDate').value,
                    certificateNo: document.getElementById('certificateNo').value
                };
                
                await appState.db.saveSettings(settings);
                showNotification('Doktor ayarları başarıyla kaydedildi!');
                settingsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Ek-2 formu için doktor bilgilerini güncelle
                document.getElementById('ek2DoctorName').textContent = settings.name || 'Dr. Ayşe Kaya';
                document.getElementById('ek2DiplomaInfo').textContent = (settings.diplomaDate ? formatDate(settings.diplomaDate) : '15/06/2010') + ' - ' + (settings.diplomaNo || '12345');
                document.getElementById('ek2CertificateInfo').textContent = (settings.certificateDate ? formatDate(settings.certificateDate) : '20/07/2015') + ' - ' + (settings.certificateNo || '67890');
                
            } catch (error) {
                console.error('Ayarlar kaydedilirken hata:', error);
                showNotification('Ayarlar kaydedilirken hata oluştu: ' + error.message, true);
            }
        }
        
        // İşyerlerini yükle
        async function loadWorkplaces() {
            try {
                appState.workplaces = await appState.db.getWorkplaces();
                renderWorkplaces();
                
                // İlk işyerini seç
                if (appState.workplaces.length > 0) {
                    selectWorkplace(appState.workplaces[0]);
                }
                
            } catch (error) {
                console.error('İşyerleri yüklenirken hata:', error);
                showNotification('İşyerleri yüklenirken hata oluştu: ' + error.message, true);
            }
        }
        
        // İşyerlerini render et
        function renderWorkplaces() {
            workplaceList.innerHTML = '';
            
            appState.workplaces.forEach(workplace => {
                const workplaceItem = document.createElement('div');
                workplaceItem.className = 'list-item';
                workplaceItem.innerHTML = `
                    <div>
                        <strong>${workplace.name}</strong>
                        <div>SGK: ${workplace.sskNo || '-'}</div>
                    </div>
                    <div class="actions">
                        <button class="action-btn edit-workplace" data-id="${workplace.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-workplace" data-id="${workplace.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                // İşyeri seçimi
                workplaceItem.addEventListener('click', () => {
                    selectWorkplace(workplace);
                });
                
                // Düzenle butonu
                workplaceItem.querySelector('.edit-workplace').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openWorkplaceModal(workplace);
                });
                
                // Sil butonu
                workplaceItem.querySelector('.delete-workplace').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteWorkplace(workplace.id);
                });
                
                workplaceList.appendChild(workplaceItem);
            });
        }
        
        // İşyeri seç
        async function selectWorkplace(workplace) {
            appState.currentWorkplace = workplace;
            
            // Seçili işyerini vurgula
            document.querySelectorAll('.list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Çalışanları yükle
            await loadEmployees(workplace.id);
            
            // İşyeri bilgilerini güncelle
            document.getElementById('employeeWorkplace').textContent = workplace.name;
        }
        
        // Çalışanları yükle
        async function loadEmployees(workplaceId) {
            try {
                appState.currentEmployees = await appState.db.getEmployees(workplaceId);
                renderEmployees();
                
                // İlk çalışanı seç
                if (appState.currentEmployees.length > 0) {
                    selectEmployee(appState.currentEmployees[0]);
                } else {
                    // Çalışan olmadığında detayları temizle
                    clearEmployeeDetails();
                }
                
            } catch (error) {
                console.error('Çalışanlar yüklenirken hata:', error);
                showNotification('Çalışanlar yüklenirken hata oluştu: ' + error.message, true);
            }
        }
        
        // Çalışanları render et
        function renderEmployees() {
            employeeList.innerHTML = '';
            
            appState.currentEmployees.forEach(employee => {
                const employeeItem = document.createElement('div');
                employeeItem.className = 'list-item';
                employeeItem.innerHTML = `
                    <div>
                        <strong>${employee.name}</strong>
                        <div>TC: ${employee.tckn || '-'}</div>
                    </div>
                    <div class="actions">
                        <button class="action-btn ek2-btn" data-id="${employee.id}" title="EK-2 Formu"><i class="fas fa-file-medical"></i></button>
                        <button class="action-btn edit-employee" data-id="${employee.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-employee" data-id="${employee.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                // Çalışan seçimi
                employeeItem.addEventListener('click', () => {
                    selectEmployee(employee);
                });
                
                // EK-2 butonu
                employeeItem.querySelector('.ek2-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectEmployee(employee);
                    openEk2Form();
                });
                
                // Düzenle butonu
                employeeItem.querySelector('.edit-employee').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openEmployeeModal(employee);
                });
                
                // Sil butonu
                employeeItem.querySelector('.delete-employee').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteEmployee(employee.id);
                });
                
                employeeList.appendChild(employeeItem);
            });
        }
        
        // Çalışan seç
        function selectEmployee(employee) {
            appState.currentEmployee = employee;
            
            // Seçili çalışanı vurgula
            document.querySelectorAll('#employeeList .list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Çalışan detaylarını güncelle
            updateEmployeeDetails(employee);
        }
        
        // Çalışan detaylarını güncelle
        function updateEmployeeDetails(employee) {
            document.getElementById('employeeName').textContent = employee.name || '-';
            document.getElementById('employeeTckn').textContent = employee.tckn || '-';
            document.getElementById('employeeBirthDate').textContent = employee.birthDate ? formatDate(employee.birthDate) : '-';
            document.getElementById('employeeGender').textContent = employee.gender || '-';
            document.getElementById('employeeEducation').textContent = employee.education || '-';
            document.getElementById('employeeAddress').textContent = employee.address || '-';
            document.getElementById('employeeDepartment').textContent = employee.department || '-';
            document.getElementById('employeePosition').textContent = employee.position || '-';
            document.getElementById('employeeStartDate').textContent = employee.startDate ? formatDate(employee.startDate) : '-';
            document.getElementById('employeeLastExam').textContent = employee.lastExamDate ? formatDate(employee.lastExamDate) : '-';
            document.getElementById('employeeNextExam').textContent = employee.nextExamDate ? formatDate(employee.nextExamDate) : '-';
        }
        
        // Çalışan detaylarını temizle
        function clearEmployeeDetails() {
            document.getElementById('employeeName').textContent = '-';
            document.getElementById('employeeTckn').textContent = '-';
            document.getElementById('employeeBirthDate').textContent = '-';
            document.getElementById('employeeGender').textContent = '-';
            document.getElementById('employeeEducation').textContent = '-';
            document.getElementById('employeeAddress').textContent = '-';
            document.getElementById('employeeDepartment').textContent = '-';
            document.getElementById('employeePosition').textContent = '-';
            document.getElementById('employeeStartDate').textContent = '-';
            document.getElementById('employeeLastExam').textContent = '-';
            document.getElementById('employeeNextExam').textContent = '-';
        }
        
        // BMI hesapla
        function calculateBMI() {
            if (heightInput.value && weightInput.value) {
                const height = heightInput.value / 100; // cm to m
                const weight = weightInput.value;
                const bmi = (weight / (height * height)).toFixed(1);
                bmiInput.value = bmi;
            }
        }
        
        // İşyeri modalını aç
        function openWorkplaceModal(workplace = null) {
            if (workplace) {
                // Düzenleme modu
                document.getElementById('workplaceModalTitle').textContent = 'İşyeri Düzenle';
                document.getElementById('workplaceName').value = workplace.name;
                document.getElementById('workplaceSskNo').value = workplace.sskNo || '';
                document.getElementById('workplaceAddress').value = workplace.address || '';
                document.getElementById('workplacePhone').value = workplace.phone || '';
                document.getElementById('workplaceEmail').value = workplace.email || '';
            } else {
                // Yeni ekleme modu
                document.getElementById('workplaceModalTitle').textContent = 'Yeni İşyeri Ekle';
                document.getElementById('workplaceName').value = '';
                document.getElementById('workplaceSskNo').value = '';
                document.getElementById('workplaceAddress').value = '';
                document.getElementById('workplacePhone').value = '';
                document.getElementById('workplaceEmail').value = '';
            }
            
            workplaceModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // İşyeri kaydet
        async function saveWorkplace() {
            const name = document.getElementById('workplaceName').value.trim();
            const sskNo = document.getElementById('workplaceSskNo').value.trim();
            const address = document.getElementById('workplaceAddress').value.trim();
            const phone = document.getElementById('workplacePhone').value.trim();
            const email = document.getElementById('workplaceEmail').value.trim();
            
            if (!name) {
                showNotification('İşyeri adı zorunludur!', true);
                return;
            }
            
            try {
                const workplace = {
                    id: appState.currentWorkplace ? appState.currentWorkplace.id : Date.now().toString(),
                    name,
                    sskNo,
                    address,
                    phone,
                    email
                };
                
                if (appState.currentWorkplace) {
                    await appState.db.updateWorkplace(workplace);
                    showNotification('İşyeri başarıyla güncellendi!');
                } else {
                    await appState.db.addWorkplace(workplace);
                    showNotification('İşyeri başarıyla eklendi!');
                }
                
                await loadWorkplaces();
                workplaceModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
            } catch (error) {
                console.error('İşyeri kaydetme hatası:', error);
                showNotification('İşyeri kaydedilirken hata oluştu: ' + error.message, true);
            }
        }
        
        // İşyeri sil
        async function deleteWorkplace(id) {
            if (confirm('Bu işyerini ve tüm çalışanlarını silmek istediğinize emin misiniz?')) {
                try {
                    // İşyerine ait çalışanları sil
                    const employees = await appState.db.getEmployees(id);
                    for (const employee of employees) {
                        await appState.db.deleteEmployee(employee.id);
                    }
                    
                    // İşyerini sil
                    await appState.db.deleteWorkplace(id);
                    showNotification('İşyeri ve çalışanları başarıyla silindi!');
                    
                    // Listeyi güncelle
                    await loadWorkplaces();
                    
                } catch (error) {
                    console.error('İşyeri silme hatası:', error);
                    showNotification('İşyeri silinirken hata oluştu: ' + error.message, true);
                }
            }
        }
        
        // Çalışan modalını aç
        function openEmployeeModal(employee = null) {
            if (!appState.currentWorkplace) {
                showNotification('Önce bir işyeri seçmelisiniz!', true);
                return;
            }
            
            if (employee) {
                // Düzenleme modu
                document.getElementById('employeeModalTitle').textContent = 'Çalışan Düzenle';
                document.getElementById('employeeName').value = employee.name || '';
                document.getElementById('employeeTckn').value = employee.tckn || '';
                document.getElementById('employeeBirthDate').value = employee.birthDate || '';
                document.getElementById('employeeGender').value = employee.gender || '';
                document.getElementById('employeeEducation').value = employee.education || '';
                document.getElementById('employeeAddress').value = employee.address || '';
                document.getElementById('employeePhone').value = employee.phone || '';
                document.getElementById('employeePosition').value = employee.position || '';
                document.getElementById('employeeDepartment').value = employee.department || '';
                document.getElementById('employeeStartDate').value = employee.startDate || '';
            } else {
                // Yeni ekleme modu
                document.getElementById('employeeModalTitle').textContent = 'Yeni Çalışan Ekle';
                document.getElementById('employeeName').value = '';
                document.getElementById('employeeTckn').value = '';
                document.getElementById('employeeBirthDate').value = '';
                document.getElementById('employeeGender').value = '';
                document.getElementById('employeeEducation').value = '';
                document.getElementById('employeeAddress').value = '';
                document.getElementById('employeePhone').value = '';
                document.getElementById('employeePosition').value = '';
                document.getElementById('employeeDepartment').value = '';
                document.getElementById('employeeStartDate').value = '';
            }
            
            employeeModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Çalışan kaydet
        async function saveEmployee() {
            const name = document.getElementById('employeeName').value.trim();
            const tckn = document.getElementById('employeeTckn').value.trim();
            const birthDate = document.getElementById('employeeBirthDate').value;
            const gender = document.getElementById('employeeGender').value;
            const education = document.getElementById('employeeEducation').value;
            const address = document.getElementById('employeeAddress').value.trim();
            const phone = document.getElementById('employeePhone').value.trim();
            const position = document.getElementById('employeePosition').value.trim();
            const department = document.getElementById('employeeDepartment').value.trim();
            const startDate = document.getElementById('employeeStartDate').value;
            
            if (!name || !tckn) {
                showNotification('Ad soyad ve TCKN zorunludur!', true);
                return;
            }
            
            if (tckn.length !== 11 || isNaN(tckn)) {
                showNotification('Geçersiz TCKN numarası!', true);
                return;
            }
            
            try {
                const employee = {
                    id: appState.currentEmployee ? appState.currentEmployee.id : Date.now().toString(),
                    workplaceId: appState.currentWorkplace.id,
                    name,
                    tckn,
                    birthDate,
                    gender,
                    education,
                    address,
                    phone,
                    position,
                    department,
                    startDate
                };
                
                if (appState.currentEmployee) {
                    await appState.db.updateEmployee(employee);
                    showNotification('Çalışan başarıyla güncellendi!');
                } else {
                    await appState.db.addEmployee(employee);
                    showNotification('Çalışan başarıyla eklendi!');
                }
                
                await loadEmployees(appState.currentWorkplace.id);
                employeeModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
            } catch (error) {
                console.error('Çalışan kaydetme hatası:', error);
                showNotification('Çalışan kaydedilirken hata oluştu: ' + error.message, true);
            }
        }
        
        // Çalışan sil
        async function deleteEmployee(id) {
            if (confirm('Bu çalışanı silmek istediğinize emin misiniz?')) {
                try {
                    await appState.db.deleteEmployee(id);
                    showNotification('Çalışan başarıyla silindi!');
                    
                    // Listeyi güncelle
                    await loadEmployees(appState.currentWorkplace.id);
                    
                } catch (error) {
                    console.error('Çalışan silme hatası:', error);
                    showNotification('Çalışan silinirken hata oluştu: ' + error.message, true);
                }
            }
        }
        
        // EK-2 formunu aç
        function openEk2Form() {
            if (!appState.currentEmployee) {
                showNotification('Önce bir çalışan seçmelisiniz!', true);
                return;
            }
            
            // Çalışan bilgilerini güncelle
            document.getElementById('ek2EmployeeName').textContent = appState.currentEmployee.name;
            document.getElementById('ek2EmployeeTckn').textContent = appState.currentEmployee.tckn;
            document.getElementById('ek2WorkplaceName').textContent = appState.currentWorkplace.name;
            
            // Bugünün tarihini ayarla
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ek2ExamDate').textContent = formatDate(today);
            
            ek2Form.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // EK-2 formunu kaydet
        async function saveMedicalForm() {
            showNotification('EK-2 formu başarıyla kaydedildi!');
            ek2Form.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Excel'den çalışanları içe aktar
        async function importEmployeesFromExcel() {
            if (!appState.currentWorkplace) {
                showNotification('Önce bir işyeri seçmelisiniz!', true);
                return;
            }
            
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.xlsx,.xls,.csv';
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        try {
                            const data = new Uint8Array(event.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            if (!jsonData.length) {
                                showNotification('Excel dosyasında veri bulunamadı!', true);
                                return;
                            }
                            
                            let importedCount = 0;
                            
                            for (const row of jsonData) {
                                try {
                                    const name = row['Ad Soyad'] || row['Adı Soyadı'] || '';
                                    const tckn = String(row['TCKN'] || row['TC Kimlik No'] || '');
                                    
                                    if (!name || !tckn) continue;
                                    if (tckn.length !== 11 || isNaN(tckn)) continue;
                                    
                                    const employee = {
                                        id: Date.now().toString(),
                                        workplaceId: appState.currentWorkplace.id,
                                        name,
                                        tckn,
                                        birthDate: row['Doğum Tarihi'] || '',
                                        gender: row['Cinsiyet'] || '',
                                        education: row['Eğitim'] || '',
                                        address: row['Adres'] || '',
                                        phone: row['Telefon'] || '',
                                        position: row['Pozisyon'] || '',
                                        department: row['Departman'] || '',
                                        startDate: row['İşe Giriş Tarihi'] || ''
                                    };
                                    
                                    await appState.db.addEmployee(employee);
                                    importedCount++;
                                    
                                } catch (error) {
                                    console.error('Satır işleme hatası:', error);
                                }
                            }
                            
                            await loadEmployees(appState.currentWorkplace.id);
                            showNotification(`${importedCount} çalışan başarıyla içe aktarıldı!`);
                            
                        } catch (error) {
                            console.error('Excel import hatası:', error);
                            showNotification('Excel dosyası okunurken hata oluştu: ' + error.message, true);
                        }
                    };
                    
                    reader.readAsArrayBuffer(file);
                };
                
                input.click();
                
            } catch (error) {
                console.error('Excel import hatası:', error);
                showNotification('Excel import işlemi sırasında hata oluştu: ' + error.message, true);
            }
        }
        
        // Çalışanları Excel'e aktar
        function exportEmployeesToExcel() {
            if (!appState.currentWorkplace || !appState.currentEmployees.length) {
                showNotification('Dışa aktarılacak çalışan bulunamadı!', true);
                return;
            }
            
            try {
                const data = [
                    ['Ad Soyad', 'TCKN', 'Doğum Tarihi', 'Cinsiyet', 'Eğitim', 'Adres', 'Telefon', 'Pozisyon', 'Departman', 'İşe Giriş Tarihi'],
                    ...appState.currentEmployees.map(emp => [
                        emp.name || '',
                        emp.tckn || '',
                        emp.birthDate ? formatDate(emp.birthDate) : '',
                        emp.gender || '',
                        emp.education || '',
                        emp.address || '',
                        emp.phone || '',
                        emp.position || '',
                        emp.department || '',
                        emp.startDate ? formatDate(emp.startDate) : ''
                    ])
                ];
                
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, 'Çalışanlar');
                
                const fileName = `${appState.currentWorkplace.name.replace(/[^a-z0-9]/gi, '_')}_Calisanlar_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
            } catch (error) {
                console.error('Excel export hatası:', error);
                showNotification('Excel dosyası oluşturulurken hata oluştu: ' + error.message, true);
            }
        }
        
        // Tarih formatlama
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }
    </script>
</body>
</html>
